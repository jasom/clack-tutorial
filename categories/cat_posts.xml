<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Clack Tutorial (Posts about posts)</title><link>https://jasom.github.io/clack-tutorial/</link><description></description><atom:link href="https://jasom.github.io/clack-tutorial/categories/cat_posts.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2021 &lt;a href="mailto:jasom@fastmail.com"&gt;Jason Miller&lt;/a&gt; </copyright><lastBuildDate>Sun, 16 May 2021 05:16:13 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Clack File Uploads</title><link>https://jasom.github.io/clack-tutorial/posts/clack-file-upoad/</link><dc:creator>Jason Miller</dc:creator><description>&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;upload-demo&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;case&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;getf&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt; &lt;span class="ss"&gt;:request-method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:get&lt;/span&gt;
     &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
       &lt;span class="mi"&gt;200&lt;/span&gt;
       &lt;span class="no"&gt;nil&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;cl-who:with-html-output-to-string&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:html&lt;/span&gt;
	    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:body&lt;/span&gt;
	     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:form&lt;/span&gt; &lt;span class="ss"&gt;:method&lt;/span&gt; &lt;span class="s"&gt;"post"&lt;/span&gt;	           &lt;span class="c1"&gt;; Any combination other than post &amp;amp; multipart/form-data&lt;/span&gt;
		    &lt;span class="ss"&gt;:enctype&lt;/span&gt; &lt;span class="s"&gt;"multipart/form-data"&lt;/span&gt; &lt;span class="c1"&gt;; causes the browser to just send the filename&lt;/span&gt;
	      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:input&lt;/span&gt; &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="s"&gt;"file"&lt;/span&gt;
		      &lt;span class="ss"&gt;:name&lt;/span&gt; &lt;span class="s"&gt;"foo"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:input&lt;/span&gt; &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="s"&gt;"submit"&lt;/span&gt;&lt;span class="p"&gt;))))))))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;req&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;lack.request:make-request&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt; &lt;span class="c1"&gt;; The lack request builder will get the&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;				  &lt;span class="c1"&gt;; body parameters for us&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;destructuring-bind&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="nv"&gt;fname&lt;/span&gt; &lt;span class="nv"&gt;content-type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cdr&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;assoc&lt;/span&gt; &lt;span class="s"&gt;"foo"&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;lack.request:request-body-parameters&lt;/span&gt; &lt;span class="nv"&gt;req&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ss"&gt;:test&lt;/span&gt; &lt;span class="nf"&gt;#'&lt;/span&gt;&lt;span class="nb"&gt;equal&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
	 &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;and&lt;/span&gt;
		&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;typep&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="ss"&gt;'file-stream&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
		&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;probe-file&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;delete-file&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;	&lt;span class="c1"&gt;; see https://github.com/fukamachi/smart-buffer/issues/1&lt;/span&gt;
	 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
	   &lt;span class="mi"&gt;200&lt;/span&gt;
	   &lt;span class="no"&gt;nil&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"~S ~S ~S ~S~%"&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="nv"&gt;fname&lt;/span&gt; &lt;span class="nv"&gt;content-type&lt;/span&gt;&lt;span class="p"&gt;))))))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>clack</category><guid>https://jasom.github.io/clack-tutorial/posts/clack-file-upoad/</guid><pubDate>Fri, 14 May 2021 05:08:54 GMT</pubDate></item><item><title>Getting started with clack</title><link>https://jasom.github.io/clack-tutorial/posts/getting-started-with-clack/</link><dc:creator>Jason Miller</dc:creator><description>&lt;p&gt;
Clack is a very simple framework for unifying the different lisp web
application servers.  However there isn't a lot of documentation for
it.  This page hopes to address this.
&lt;/p&gt;

&lt;div id="outline-container-org553d171" class="outline-2"&gt;
&lt;h2 id="org553d171"&gt;Annotated examples of usage&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-org553d171"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org7abf068" class="outline-3"&gt;
&lt;h3 id="org7abf068"&gt;Formatting&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org7abf068"&gt;
&lt;p&gt;
All input and output are presented in monospaced preformatted blocks.
The color indicates what sort they are:
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s"&gt;"Lisp code has a gray background; it can be typed at the REPL"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
NIL
&lt;/pre&gt;


&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;: shell code has a green background, it can be typed at a shell prompt
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="s"&gt;"Output from running commands has a yellow background; do not type this"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
Output from running commands has a yellow background; do not type this
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org73f0f02" class="outline-3"&gt;
&lt;h3 id="org73f0f02"&gt;Load dependencies used in examples:&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org73f0f02"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ql:quickload&lt;/span&gt; &lt;span class="o"&gt;'&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;clack&lt;/span&gt; &lt;span class="nv"&gt;alexandria&lt;/span&gt; &lt;span class="nv"&gt;optima&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="ss"&gt;:optima&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
To load "clack":
  Load 1 ASDF system:
    clack
; Loading "clack"
...
To load "alexandria":
  Load 1 ASDF system:
    alexandria
; Loading "alexandria"

To load "optima":
  Load 1 ASDF system:
    optima
; Loading "optima"

&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org57c9b46" class="outline-3"&gt;
&lt;h3 id="org57c9b46"&gt;Start a simple server&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org57c9b46"&gt;
&lt;p&gt;
The only required argument for &lt;code&gt;clackup&lt;/code&gt; is the application; the
simplest form of the application is a function of one argument.
&lt;/p&gt;

&lt;p&gt;
The function should retun a list of the form (&lt;i&gt;http-response-code&lt;/i&gt; &lt;i&gt;http-headers-alist&lt;/i&gt; &lt;i&gt;&amp;amp;optional&lt;/i&gt; &lt;i&gt;body&lt;/i&gt;)
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;body&lt;/i&gt; can be a vector of &lt;code&gt;(unsigned-byte 8)&lt;/code&gt;, a pathname, or a list of strings.
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defparameter&lt;/span&gt; &lt;span class="vg"&gt;*clack-server*&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;clack:clackup&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                                         &lt;span class="o"&gt;'&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Hello, World!"&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
Hunchentoot server is started.
Listening on localhost:5000.
&lt;/pre&gt;



&lt;p&gt;
Let's test it with curl:
&lt;/p&gt;

&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   curl -s http://localhost:5000
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
Hello, World!
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org5c5c854" class="outline-3"&gt;
&lt;h3 id="org5c5c854"&gt;Stop the server&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org5c5c854"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;clack:stop&lt;/span&gt; &lt;span class="vg"&gt;*clack-server*&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-org57ecf2c" class="outline-3"&gt;
&lt;h3 id="org57ecf2c"&gt;Redefining the handler&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-org57ecf2c"&gt;
&lt;p&gt;
It's a bit of a pain to have to restart the server all the time, let's make a redefinable handler:
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;handler&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;'&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Hello World, redefinable!"&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
And start the server; we call the function by name to allow redefinition
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defparameter&lt;/span&gt; &lt;span class="vg"&gt;*clack-server*&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;clack:clackup&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;funcall&lt;/span&gt; &lt;span class="ss"&gt;'handler&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;pre class="example"&gt;
Hunchentoot server is started.
Listening on localhost:5000.
&lt;/pre&gt;


&lt;p&gt;
Check that it worksâ¦
&lt;/p&gt;
&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   curl -s http://localhost:5000
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
Hello World, redefinable!
&lt;/pre&gt;


&lt;p&gt;
Now let's redefine it and take a look at what is in the environment:
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;handler&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
       &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;prin1-to-string&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;
View resultsâ¦
&lt;/p&gt;
&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   curl -s http://localhost:5000
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
(:REQUEST-METHOD :GET :SCRIPT-NAME "" :PATH-INFO "/" :SERVER-NAME "localhost"
 :SERVER-PORT 5000 :SERVER-PROTOCOL :HTTP/1.1 :REQUEST-URI "/" :URL-SCHEME
 "http" :REMOTE-ADDR "127.0.0.1" :REMOTE-PORT 53824 :QUERY-STRING NIL :RAW-BODY
 #&amp;lt;FLEXI-STREAMS:FLEXI-IO-STREAM {1021B536E3}&amp;gt; :CONTENT-LENGTH NIL
 :CONTENT-TYPE NIL :CLACK.STREAMING T :CLACK.IO
 #&amp;lt;CLACK.HANDLER.HUNCHENTOOT::CLIENT {1021B537F3}&amp;gt; :HEADERS
 #&amp;lt;HASH-TABLE :TEST EQUAL :COUNT 3 {1021B53C13}&amp;gt;)
&lt;/pre&gt;


&lt;p&gt;
This is the core part of clack; the environment plist.
&lt;/p&gt;

&lt;p&gt;
Documentation for it is available &lt;a href="https://github.com/fukamachi/lack#the-environment"&gt;in the lack README&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
The fact that it is a plist means capturing values of interest can be done with &lt;code&gt;destructuring-bind&lt;/code&gt;:
&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;handler&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;destructuring-bind&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;&amp;amp;key&lt;/span&gt; &lt;span class="nv"&gt;request-method&lt;/span&gt; &lt;span class="nv"&gt;path-info&lt;/span&gt; &lt;span class="nv"&gt;request-uri&lt;/span&gt;
                              &lt;span class="nv"&gt;query-string&lt;/span&gt; &lt;span class="nv"&gt;headers&lt;/span&gt; &lt;span class="k"&gt;&amp;amp;allow-other-keys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nv"&gt;env&lt;/span&gt;
      &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt;
        &lt;span class="no"&gt;nil&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"Method: ~S Path: ~S URI: ~A Query: ~S~%Headers: ~S"&lt;/span&gt;
                  &lt;span class="nv"&gt;request-method&lt;/span&gt; &lt;span class="nv"&gt;path-info&lt;/span&gt; &lt;span class="nv"&gt;request-uri&lt;/span&gt; &lt;span class="nv"&gt;query-string&lt;/span&gt;
                  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;alexandria:hash-table-alist&lt;/span&gt; &lt;span class="nv"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;))))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -s http://localhost:5000
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
Method: :GET Path: "/" URI: / Query: NIL
Headers: (("accept" . "*/*") ("user-agent" . "curl/7.53.0")
          ("host" . "localhost:5000"))
&lt;/pre&gt;


&lt;p&gt;
Optima can be useful too:
&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;handler&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;optima:match&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;
      &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;guard&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;property&lt;/span&gt; &lt;span class="ss"&gt;:path-info&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
              &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;alexandria:starts-with-subseq&lt;/span&gt; &lt;span class="s"&gt;"/foo/"&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
       &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"The path '~A' is in /foo/~%"&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
      &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;guard&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;property&lt;/span&gt; &lt;span class="ss"&gt;:path-info&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
              &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;alexandria:starts-with-subseq&lt;/span&gt; &lt;span class="s"&gt;"/bar/"&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
       &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"The path '~A' is in /bar/~%"&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
      &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;property&lt;/span&gt; &lt;span class="ss"&gt;:path-info&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
       &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"Path ~A not found~%"&lt;/span&gt; &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="p"&gt;))))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="sh"&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   curl -s http://localhost:5000/foo/quux
   curl -s http://localhost:5000/bar/quux
   curl -s http://localhost:5000/baz/quux
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;pre class="example"&gt;
The path '/foo/quux' is in /foo/
The path '/bar/quux' is in /bar/
Path /baz/quux not found
&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-orga2245f0" class="outline-2"&gt;
&lt;h2 id="orga2245f0"&gt;Public API&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-orga2245f0"&gt;
&lt;/div&gt;
&lt;div id="outline-container-orgaf2c874" class="outline-3"&gt;
&lt;h3 id="orgaf2c874"&gt;CLACK:CLACKUP&lt;/h3&gt;
&lt;div class="outline-text-3" id="text-orgaf2c874"&gt;
&lt;/div&gt;
&lt;div id="outline-container-org1fd8fed" class="outline-4"&gt;
&lt;h4 id="org1fd8fed"&gt;Syntax:&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org1fd8fed"&gt;
&lt;p&gt;
&lt;b&gt;clackup&lt;/b&gt; &lt;i&gt;app&lt;/i&gt; &lt;i&gt;&amp;amp;key&lt;/i&gt; &lt;i&gt;server&lt;/i&gt; &lt;i&gt;port&lt;/i&gt; &lt;i&gt;debug&lt;/i&gt; &lt;i&gt;silent&lt;/i&gt;
&lt;i&gt;use-thread&lt;/i&gt; &lt;i&gt;use-default-middlewares&lt;/i&gt; &lt;i&gt;&amp;amp;allow-other-keys&lt;/i&gt;
&lt;/p&gt;


&lt;p&gt;
=&amp;gt; &lt;i&gt;handler&lt;/i&gt;
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id="outline-container-org0ceb397" class="outline-4"&gt;
&lt;h4 id="org0ceb397"&gt;Arguments and Values:&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-org0ceb397"&gt;
&lt;/div&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;&lt;a id="org5a5a47d"&gt;&lt;/a&gt;&lt;i&gt;app&lt;/i&gt;âA &lt;i&gt;designator&lt;/i&gt; for a &lt;i&gt;function&lt;/i&gt; of one argument;or a subclass of &lt;code&gt;lack.component:lack-component&lt;/code&gt;;or a &lt;i&gt;pathname&lt;/i&gt;; or a &lt;i&gt;string&lt;/i&gt;.&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="orgae5ea00"&gt;&lt;/a&gt;&lt;i&gt;server&lt;/i&gt;âA symbol.  The default is &lt;code&gt;:hunchentoot&lt;/code&gt;&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="org0d80dbd"&gt;&lt;/a&gt;&lt;i&gt;port&lt;/i&gt;âAn integer.  The default is 5000&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="org314220e"&gt;&lt;/a&gt;&lt;i&gt;debug&lt;/i&gt;âA boolean.  The default is &lt;code&gt;t&lt;/code&gt;&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="orgf77bb28"&gt;&lt;/a&gt;&lt;i&gt;silent&lt;/i&gt;âA boolean.  The default is &lt;code&gt;nil&lt;/code&gt;&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="org41c01bc"&gt;&lt;/a&gt;&lt;i&gt;use-thread&lt;/i&gt;âA boolean.  The default is &lt;code&gt;t&lt;/code&gt; on systems that support threading and &lt;code&gt;nil&lt;/code&gt; otherwise.&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="orgc1f5857"&gt;&lt;/a&gt;&lt;i&gt;use-default-middlewares&lt;/i&gt;âA boolean.  The default is &lt;code&gt;t&lt;/code&gt;&lt;br&gt;&lt;/li&gt;

&lt;li&gt;&lt;a id="orge99d394"&gt;&lt;/a&gt;&lt;i&gt;handler&lt;/i&gt;âA clack.handler::handler.&lt;br&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;div id="outline-container-orgcb1efde" class="outline-4"&gt;
&lt;h4 id="orgcb1efde"&gt;Description:&lt;/h4&gt;
&lt;div class="outline-text-4" id="text-orgcb1efde"&gt;
&lt;p&gt;
&lt;code&gt;clackup&lt;/code&gt; starts a server using the backend designated by &lt;i&gt;server&lt;/i&gt; on
port &lt;i&gt;port&lt;/i&gt;.
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;app&lt;/i&gt; is used to build the handler chain for the server as follows:
&lt;/p&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;If &lt;i&gt;app&lt;/i&gt; is a function then it will be used directly, and called on each request with the requst environment as its only parameter&lt;/li&gt;
&lt;li&gt;If &lt;i&gt;app&lt;/i&gt; is a subclass of &lt;code&gt;lack.component:lack-component&lt;/code&gt; then (lack.component:call &lt;i&gt;app&lt;/i&gt; &lt;i&gt;environment&lt;/i&gt;) will be called on every request&lt;/li&gt;
&lt;li&gt;If &lt;i&gt;app&lt;/i&gt; is a pathname then it will be treated as a lisp file to be evaluated.  The result of the last form of the file will be used as above&lt;/li&gt;
&lt;li&gt;If &lt;i&gt;app&lt;/i&gt; is a string, then it will be coerced to a pathname and used as above.&lt;/li&gt;
&lt;li&gt;If &lt;i&gt;use-default-middlewares&lt;/i&gt; is &lt;i&gt;true&lt;/i&gt; then &lt;i&gt;app&lt;/i&gt; will be wrapped by the default middlewares&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;
&lt;i&gt;server&lt;/i&gt; designates the backend to use; if the backend is not found,
then &lt;code&gt;clackup&lt;/code&gt; will attempt to load it via &lt;code&gt;quicklisp&lt;/code&gt; or &lt;code&gt;asdf&lt;/code&gt;.
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;port&lt;/i&gt; specifies which port to listen on.
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;debug&lt;/i&gt; specifies that debug mode is on.  The results of this is
backend specific, but typically will handle all errors in the body of
&lt;i&gt;app&lt;/i&gt; by returning a 500 response to the user if &lt;i&gt;false&lt;/i&gt;
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;silent&lt;/i&gt; Suppresses printing of status messages.
&lt;/p&gt;

&lt;p&gt;
&lt;i&gt;use-thread&lt;/i&gt; If &lt;i&gt;true&lt;/i&gt;, the backend is launched in a separate thread.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description><guid>https://jasom.github.io/clack-tutorial/posts/getting-started-with-clack/</guid><pubDate>Mon, 27 Mar 2017 06:36:28 GMT</pubDate></item></channel></rss>