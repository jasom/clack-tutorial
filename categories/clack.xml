<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Clack Tutorial (Posts about clack)</title><link>https://jasom.github.io/clack-tutorial/</link><description></description><atom:link href="https://jasom.github.io/clack-tutorial/categories/clack.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2021 &lt;a href="mailto:jasom@fastmail.com"&gt;Jason Miller&lt;/a&gt; </copyright><lastBuildDate>Sun, 16 May 2021 05:16:13 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Clack File Uploads</title><link>https://jasom.github.io/clack-tutorial/posts/clack-file-upoad/</link><dc:creator>Jason Miller</dc:creator><description>&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;upload-demo&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;case&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;getf&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt; &lt;span class="ss"&gt;:request-method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:get&lt;/span&gt;
     &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
       &lt;span class="mi"&gt;200&lt;/span&gt;
       &lt;span class="no"&gt;nil&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;cl-who:with-html-output-to-string&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:html&lt;/span&gt;
	    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:body&lt;/span&gt;
	     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:form&lt;/span&gt; &lt;span class="ss"&gt;:method&lt;/span&gt; &lt;span class="s"&gt;"post"&lt;/span&gt;	           &lt;span class="c1"&gt;; Any combination other than post &amp;amp; multipart/form-data&lt;/span&gt;
		    &lt;span class="ss"&gt;:enctype&lt;/span&gt; &lt;span class="s"&gt;"multipart/form-data"&lt;/span&gt; &lt;span class="c1"&gt;; causes the browser to just send the filename&lt;/span&gt;
	      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:input&lt;/span&gt; &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="s"&gt;"file"&lt;/span&gt;
		      &lt;span class="ss"&gt;:name&lt;/span&gt; &lt;span class="s"&gt;"foo"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:input&lt;/span&gt; &lt;span class="ss"&gt;:type&lt;/span&gt; &lt;span class="s"&gt;"submit"&lt;/span&gt;&lt;span class="p"&gt;))))))))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ss"&gt;:post&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;req&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;lack.request:make-request&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt; &lt;span class="c1"&gt;; The lack request builder will get the&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;print&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;				  &lt;span class="c1"&gt;; body parameters for us&lt;/span&gt;
       &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;destructuring-bind&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="nv"&gt;fname&lt;/span&gt; &lt;span class="nv"&gt;content-type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cdr&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;assoc&lt;/span&gt; &lt;span class="s"&gt;"foo"&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;lack.request:request-body-parameters&lt;/span&gt; &lt;span class="nv"&gt;req&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ss"&gt;:test&lt;/span&gt; &lt;span class="nf"&gt;#'&lt;/span&gt;&lt;span class="nb"&gt;equal&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
	 &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;and&lt;/span&gt;
		&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;typep&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="ss"&gt;'file-stream&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
		&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;probe-file&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;delete-file&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;	&lt;span class="c1"&gt;; see https://github.com/fukamachi/smart-buffer/issues/1&lt;/span&gt;
	 &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
	   &lt;span class="mi"&gt;200&lt;/span&gt;
	   &lt;span class="no"&gt;nil&lt;/span&gt;
	   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;format&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="s"&gt;"~S ~S ~S ~S~%"&lt;/span&gt; &lt;span class="nv"&gt;env&lt;/span&gt; &lt;span class="nc"&gt;stream&lt;/span&gt; &lt;span class="nv"&gt;fname&lt;/span&gt; &lt;span class="nv"&gt;content-type&lt;/span&gt;&lt;span class="p"&gt;))))))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>clack</category><guid>https://jasom.github.io/clack-tutorial/posts/clack-file-upoad/</guid><pubDate>Fri, 14 May 2021 05:08:54 GMT</pubDate></item></channel></rss>